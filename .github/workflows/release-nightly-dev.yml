name: 'NocoDB Nightly Dev Release'

on:
  # Triggered manually
  workflow_dispatch:
    inputs:
      tag:
        description: "Target Tag"
        required: true
  schedule:
    # at the end of every day
    - cron: '0 0 * * *'
jobs:
  # enrich tag for nightly auto release
  set-tag:
    runs-on: 'ubuntu-latest'
#     if: (github.event_name == 'schedule')
    steps:
      - name: set-tag
        id: tag-step
        run: |
          # Get current date
          export CURRENT_DATE=$(date +"%Y%m%d")
          echo ${CURRENT_DATE}
          # Set the tag
          echo "::set-output name=NIGHTLY_BUILD_TAG::nightly-${CURRENT_DATE}"
          # Verify the tag
      - name: verify-tag
        run: echo ${{ steps.tag-step.outputs.NIGHTLY_BUILD_TAG }}
    outputs:
      nightly_build_tag: ${{ steps.tag-step.outputs.NIGHTLY_BUILD_TAG }}
  test:
    runs-on: 'ubuntu-latest'
    needs: set-tag
    steps:
      - name: verify
        run: |
          echo ${{ jobs.set-tag.outputs.nightly_build_tag }}
          echo ${{ needs.set-tag.outputs.nightly_build_tag }}
#   Build docker image and push to docker hub
#   release-docker:
#     uses: ./.github/workflows/release-docker.yml
#     with:
#       tag: $ {{ jobs.set-tag.outputs.nightly_build_tag }}
#       tag: ${{ github.event.inputs.tag ||  jobs.set-tag.steps.tag-step.NIGHTLY_BUILD_TAG }}
